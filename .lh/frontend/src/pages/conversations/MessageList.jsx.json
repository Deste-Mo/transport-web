{
    "sourceFile": "frontend/src/pages/conversations/MessageList.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1722234790713,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1722236246063,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -68,27 +68,6 @@\n         </motion.section>\r\n     )\r\n }\r\n \r\n-// const DiscussionCard = ({profileImage, messageSeen, fullName, accountType, lastMessage, lastMessageTime}) => {\r\n-   \r\n-//     return (\r\n-//         <div className={\"flex items-center justify-between cursor-pointer w-full hover:bg-primary-20 p-6 rounded-xl\"}>\r\n-//             <div className=\"flex items-center gap-2\">\r\n-//                 <img className=\"size-[40px] object-cover rounded-full\" src={ProfileImage}/>\r\n-//                 <div className=\"flex flex-col gap-1 items-start\">\r\n-//                     <p className=\"text-black-100 text-small-1\">RAHARISOA Haingonirina (Client)</p>\r\n-//                     <p className={\"text-black-100 font-bold text-small-1\"}>\r\n-//                         Lorem ipsum dolor sit amet\r\n-//                     </p>\r\n-//                 </div>\r\n-//             </div>\r\n-//             <div className=\"flex items-center gap-1\">\r\n-//                 <div className=\"size-[10px] rounded-full bg-primary-100\"\r\n-//                 ></div>\r\n-//                 <p className={\"text-small-2 text-black-80 font-light\"}>Il y a 10 min</p>\r\n-//             </div>\r\n-//         </div>\r\n-// )\r\n-// }\r\n \r\n export default MessageList;\n\\ No newline at end of file\n"
                },
                {
                    "date": 1723565622967,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,73 +1,101 @@\n-import {Button, TextInput} from \"../../styles/components\";\r\n-import React, {useState, useEffect} from \"react\";\r\n-import {useAuth} from \"../../context/AuthProvider\";\r\n-import {useApp} from \"../../context/AppProvider\";\r\n-import {useSocketContext} from \"../../context/SocketContext\";\r\n+import { Button, TextInput } from \"../../styles/components\";\r\n+import React, { useState, useEffect } from \"react\";\r\n+import { useAuth } from \"../../context/AuthProvider\";\r\n+import { useApp } from \"../../context/AppProvider\";\r\n+import { useSocketContext } from \"../../context/SocketContext\";\r\n import ActiveUser from \"../../components/pages/conversations/ActiveUser.jsx\";\r\n-import {SubHeader} from \"../../components/pages/SubHeader.jsx\";\r\n+import { SubHeader } from \"../../components/pages/SubHeader.jsx\";\r\n import SearchBar from \"../../components/ui/SearchBar.jsx\";\r\n import ProfileImage from \"../../assets/images/OIP.jpg\";\r\n import Conv from \"../../components/pages/conversations/Conversation.jsx\";\r\n-import {motion} from \"framer-motion\";\r\n-import {appVariants} from \"../../animations/variants.js\";\r\n+import { motion } from \"framer-motion\";\r\n+import { appVariants } from \"../../animations/variants.js\";\r\n+import { useUser } from \"../../context/UserProvider.jsx\";\r\n+import { Navigate, useNavigate } from \"react-router-dom\";\r\n+import ExpandableSearchBar from \"../../components/ui/ExpandableSearchBar.jsx\";\r\n \r\n \r\n const MessageList = () => {\r\n \r\n-    const {token, loading} = useAuth();\r\n+    const { token } = useAuth();\r\n \r\n-    const {conversations, handleShowConversation, friends, handleFriends} = useApp();\r\n+    const navigate = useNavigate();\r\n \r\n-    const {socket} = useSocketContext();\r\n+    const { conversations, handleShowConversation } = useApp();\r\n+    const { friends, getFriends } = useUser();\r\n \r\n-    const {messages, setMessages} = useApp();\r\n+    const { socket } = useSocketContext();\r\n \r\n+    const { messages, setMessages } = useApp();\r\n+\r\n+\r\n+    const [search, setSearch] = useState('');\r\n+\r\n+    const SearchFriends = friends.length > 0 ? (friends.filter(friend => {\r\n+        let fullname = friend.firstname.toLowerCase() + \" \" + (friend.lastname ? friend.lastname.toLowerCase() : '');\r\n+        if (search && !fullname.includes(search.toLowerCase())) {\r\n+            return false;\r\n+        }\r\n+        return true;\r\n+    })) : null;\r\n+\r\n     useEffect(() => {\r\n \r\n-        handleFriends();\r\n+        getFriends();\r\n         handleShowConversation();\r\n \r\n         socket?.on(\"newMessage\", (newMessage) => {\r\n             setMessages([...messages, newMessage]);\r\n             handleShowConversation();\r\n+            getUnreadMessageCount\r\n         });\r\n \r\n         return () => socket?.off(\"newMessage\")\r\n \r\n     }, [socket, token, setMessages])\r\n \r\n     return (\r\n         <motion.section className=\"flex flex-col items-center justify-start w-full gap-6 relative  min-h-screen\" variants={appVariants} initial=\"hidden\" whileInView=\"visible\" viewport={{once : true}}>\r\n-            <SubHeader name={\"Messages\"} icon={\"bi bi-chat\"}/>\r\n+                <SubHeader name={\"Messages\"} icon={\"bi bi-chat\"} rightContent={<ExpandableSearchBar setValue={setSearch} placeholder={\"Rechercher un ami\"} value={search}/>}/>\r\n\\ No newline at end of file\n             <div\r\n-                className=\"w-full h-fit bg-white-100 flex justify-start overflow-auto p-4 border border-black-0 rounded-2xl scrollbar-none \">\r\n+                className=\"w-full h-fit bg-white-100 dark:bg-black-100 dark:border-none flex justify-start overflow-x-scroll p-4 border border-black-0 rounded-2xl scrollbar-none \">\r\n                 {friends.length > 0 ?\r\n                     friends.map(friend => (\r\n                         <ActiveUser key={friend.userid} friend={friend}/>\r\n                     )) :\r\n                     <div>\r\n-                        <Button icon=\"bi bi-plus-lg\">Ajouter un ami</Button>\r\n+                        <Button icon=\"bi bi-plus-lg\" onClick={() => navigate(\"/friend\")}>Ajouter un ami</Button>\r\n                     </div>\r\n                 }\r\n             </div>\r\n \r\n-            <SearchBar variant={\"fill\"} block size={\"lg\"} placeholder={\"Rechercher un ami\"}/>\r\n+            {/* <SearchBar variant={\"fill\"} block size={\"lg\"} value={search} setValue={setSearch} placeholder={\"Rechercher un ami\"} /> */}\r\n \r\n-            <div className=\"w-full  h-[70%] bg-white-100  flex flex-col gap-4 overflow-hidden p-4  rounded-xl border border-black-0\">\r\n-                {conversations.length > 0 ?\r\n+            <div className=\"w-full h-[60vh] scrollbar-none overflow-y-scroll bg-white-100 dark:bg-white-0 dark:border-none  flex flex-col gap-3 overflow-hidden p-2  rounded-xl border border-black-0\">\r\n+                {\r\n+                    search ?\r\n+                        SearchFriends?.length > 0 ?\r\n+                            SearchFriends.map(conversation => (\r\n+                                <Conv key={conversation.userid} id={conversation.userid} userToChat={conversation} />\r\n+                            )\r\n+                            )\r\n+                            :\r\n+                            <p className=\"nothing-box\">\r\n+                                Aucun resultat\r\n+                            </p>\r\n+                        :\r\n+                        conversations.length > 0 ?\r\n                     conversations.map(conversation => (\r\n                             <Conv key={conversation.userid} id={conversation.userid} userToChat={conversation}/>\r\n                         )\r\n                     )\r\n                     :\r\n-                    <p className=\"text-black-80  text-center\">\r\n-                        Commencer une conversation !\r\n+                            <p className=\"w-full px-4 py-10 text-center text-black-80 bg-white-100 border border-black-0 rounded-xl dark:border-none dark:bg-black-10 dark:text-white-60\">\r\n+                                Commencez une Conversation\r\n                     </p>\r\n                 }\r\n             </div>\r\n         </motion.section>\r\n     )\r\n }\r\n-\r\n-\r\n-export default MessageList;\n+export default MessageList;\r\n"
                },
                {
                    "date": 1723565631810,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,9 +20,9 @@\n     const { token } = useAuth();\r\n \r\n     const navigate = useNavigate();\r\n \r\n-    const { conversations, handleShowConversation } = useApp();\r\n+    const { conversations, handleShowConversation, getUnreadMessageCount } = useApp();\r\n     const { friends, getFriends } = useUser();\r\n \r\n     const { socket } = useSocketContext();\r\n \r\n@@ -46,9 +46,9 @@\n \r\n         socket?.on(\"newMessage\", (newMessage) => {\r\n             setMessages([...messages, newMessage]);\r\n             handleShowConversation();\r\n-            getUnreadMessageCount\r\n+            getUnreadMessageCount();\r\n         });\r\n \r\n         return () => socket?.off(\"newMessage\")\r\n \r\n@@ -97,5 +97,5 @@\n             </div>\r\n         </motion.section>\r\n     )\r\n }\r\n-export default MessageList;\n\\ No newline at end of file\n+export default MessageList;\r\n"
                }
            ],
            "date": 1722234790713,
            "name": "Commit-0",
            "content": "import {Button, TextInput} from \"../../styles/components\";\r\nimport React, {useState, useEffect} from \"react\";\r\nimport {useAuth} from \"../../context/AuthProvider\";\r\nimport {useApp} from \"../../context/AppProvider\";\r\nimport {useSocketContext} from \"../../context/SocketContext\";\r\nimport ActiveUser from \"../../components/pages/conversations/ActiveUser.jsx\";\r\nimport {SubHeader} from \"../../components/pages/SubHeader.jsx\";\r\nimport SearchBar from \"../../components/ui/SearchBar.jsx\";\r\nimport ProfileImage from \"../../assets/images/OIP.jpg\";\r\nimport Conv from \"../../components/pages/conversations/Conversation.jsx\";\r\nimport {motion} from \"framer-motion\";\r\nimport {appVariants} from \"../../animations/variants.js\";\r\n\r\n\r\nconst MessageList = () => {\r\n\r\n    const {token, loading} = useAuth();\r\n\r\n    const {conversations, handleShowConversation, friends, handleFriends} = useApp();\r\n\r\n    const {socket} = useSocketContext();\r\n\r\n    const {messages, setMessages} = useApp();\r\n\r\n    useEffect(() => {\r\n\r\n        handleFriends();\r\n        handleShowConversation();\r\n\r\n        socket?.on(\"newMessage\", (newMessage) => {\r\n            setMessages([...messages, newMessage]);\r\n            handleShowConversation();\r\n        });\r\n\r\n        return () => socket?.off(\"newMessage\")\r\n\r\n    }, [socket, token, setMessages])\r\n\r\n    return (\r\n        <motion.section className=\"flex flex-col items-center justify-start w-full gap-6 relative  min-h-screen\" variants={appVariants} initial=\"hidden\" whileInView=\"visible\" viewport={{once : true}}>\r\n            <SubHeader name={\"Messages\"} icon={\"bi bi-chat\"}/>\r\n            <div\r\n                className=\"w-full h-fit bg-white-100 flex justify-start overflow-auto p-4 border border-black-0 rounded-2xl scrollbar-none \">\r\n                {friends.length > 0 ?\r\n                    friends.map(friend => (\r\n                        <ActiveUser key={friend.userid} friend={friend}/>\r\n                    )) :\r\n                    <div>\r\n                        <Button icon=\"bi bi-plus-lg\">Ajouter un ami</Button>\r\n                    </div>\r\n                }\r\n            </div>\r\n\r\n            <SearchBar variant={\"fill\"} block size={\"lg\"} placeholder={\"Rechercher un ami\"}/>\r\n\r\n            <div className=\"w-full  h-[70%] bg-white-100  flex flex-col gap-4 overflow-hidden p-4  rounded-xl border border-black-0\">\r\n                {conversations.length > 0 ?\r\n                    conversations.map(conversation => (\r\n                            <Conv key={conversation.userid} id={conversation.userid} userToChat={conversation}/>\r\n                        )\r\n                    )\r\n                    :\r\n                    <p className=\"text-black-80  text-center\">\r\n                        Commencer une conversation !\r\n                    </p>\r\n                }\r\n            </div>\r\n        </motion.section>\r\n    )\r\n}\r\n\r\n// const DiscussionCard = ({profileImage, messageSeen, fullName, accountType, lastMessage, lastMessageTime}) => {\r\n   \r\n//     return (\r\n//         <div className={\"flex items-center justify-between cursor-pointer w-full hover:bg-primary-20 p-6 rounded-xl\"}>\r\n//             <div className=\"flex items-center gap-2\">\r\n//                 <img className=\"size-[40px] object-cover rounded-full\" src={ProfileImage}/>\r\n//                 <div className=\"flex flex-col gap-1 items-start\">\r\n//                     <p className=\"text-black-100 text-small-1\">RAHARISOA Haingonirina (Client)</p>\r\n//                     <p className={\"text-black-100 font-bold text-small-1\"}>\r\n//                         Lorem ipsum dolor sit amet\r\n//                     </p>\r\n//                 </div>\r\n//             </div>\r\n//             <div className=\"flex items-center gap-1\">\r\n//                 <div className=\"size-[10px] rounded-full bg-primary-100\"\r\n//                 ></div>\r\n//                 <p className={\"text-small-2 text-black-80 font-light\"}>Il y a 10 min</p>\r\n//             </div>\r\n//         </div>\r\n// )\r\n// }\r\n\r\nexport default MessageList;"
        }
    ]
}